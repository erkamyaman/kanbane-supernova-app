<div class="columns-container py-2">
  <div class="flex justify-content-between align-items-center mb-3">
    <h3>Manage Columns</h3>
    <p-button [label]="showCreateForm ? 'Cancel' : 'Add Column'" [icon]="showCreateForm ? 'pi pi-times' : 'pi pi-plus'" (onClick)="toggleCreateForm()" [outlined]="true" [size]="'small'" />
  </div>

  @if (showCreateForm) {
  <div class="create-form mb-3 p-3 border-round border-1 border-gray-300">
    <div class="flex flex-column gap-3">
      <div class="flex flex-column gap-2">
        <label for="columnTitle" class="font-medium">Column Title</label>
        <input pInputText id="columnTitle" [(ngModel)]="newColumn.title" placeholder="Enter column title (min 3 characters)" class="w-full" />
      </div>

      <div class="flex flex-column gap-2">
        <label for="columnIcon" class="font-medium">Icon</label>
        <p-select id="columnIcon" [options]="iconOptions" [(ngModel)]="newColumn.icon" optionLabel="label" optionValue="value" placeholder="Select an icon" class="w-full">
          <ng-template pTemplate="selectedItem" let-selectedOption>
            <div class="flex align-items-center gap-2">
              <i [class]="'pi ' + selectedOption.value" class="text-sm"></i>
              <span>{{ selectedOption.label }}</span>
            </div>
          </ng-template>

          <ng-template pTemplate="item" let-option>
            <div class="flex align-items-center gap-2">
              <i [class]="'pi ' + option.value" class="text-sm"></i>
              <span>{{ option.label }}</span>
            </div>
          </ng-template>
        </p-select>
      </div>

      <div class="flex flex-column gap-2">
        <label for="columnColor" class="font-medium">Icon Color</label>
        <input type="color" id="columnColor" [(ngModel)]="newColumn.iconColor" class="w-full" style="height: 40px; border-radius: 6px; border: 1px solid var(--surface-border)" />
      </div>

      <div class="flex gap-2">
        <p-button label="Create Column" icon="pi pi-check" (onClick)="createColumn()" [disabled]="!newColumn.title || newColumn.title.trim().length < 3 || isLoading" [loading]="isLoading" />
        <p-button label="Cancel" icon="pi pi-times" (onClick)="resetForm()" [outlined]="true" [severity]="'secondary'" />
      </div>
    </div>
  </div>
  } @if (isLoading) {
  <div class="loading">
    <p>Loading columns...</p>
  </div>
  } @if (!isLoading && columns.length === 0) {
  <div class="no-columns">
    <p>No columns found.</p>
  </div>
  } @if (!isLoading && columns.length > 0) {
  <div class="columns-list">
    @for (column of columns; track column.id) {
    <div class="column-item flex justify-content-between align-items-center p-3 mb-2 border-round border-1 border-gray-300">
      <div class="flex align-items-center gap-2">
        <i [class]="'pi ' + column.icon" class="text-lg" [style]="{'color': column.iconColor}"></i>
        <span class="font-medium">{{ column.title }}</span>
      </div>
      <p-button type="button" severity="danger" icon="pi pi-trash" (onClick)="deleteColumnConfirmation($event, column.id)" [disabled]="isLoading" />
    </div>
    }
  </div>
  }
</div>
