<div class="flex flex-row align-items-center gap-2 w-fit h-auto mt-3 mb-3 border-round-md">
  @for (col of columns; track col.id; let isLast = $last) {
  <div style="height: 80vh" class="flex flex-column pb-3 bg-color-custom w-22rem border-round-md border-1 border-gray-500" pDroppable (onDrop)="drop(col.id)">
    <div class="flex flex-row mb-3 px-3 my-4 align-items-center justify-content-between no-select">
      <div class="flex flex-row gap-2 align-items-center justify-content-center">
        <i [ngClass]="'pi ' + col.icon " [ngStyle]="{ 'font-size': '1.5rem', 'color': col.iconColor }"></i>
        <div class="column-icon">{{col.title}}</div>
      </div>
      <i class="pi pi-pencil text-primary-400 cursor-pointer" style="font-size: 0.75rem" (click)="editColumn(col)"></i>
    </div>
    @if (tasks.length) {
    <ul class="list-none flex flex-column gap-2 p-0 m-0 pb-4 overflow-y-auto align-items-start">
      @for (task of tasks; track $index) { @if(task.columnId === col.id){
      <li class="p-2 mx-3 mb-2 border-round-md border-1 border-gray-500 text-center cursor-pointer flex align-items-start" style="position: relative; height: 100px; min-height: 100px; max-height: 100px; width: 19rem; min-width: 19rem; max-width: 19rem" pDraggable (click)="showTaskDrawer(task)" (onDragStart)="dragStart(task, col.id)" (onDragEnd)="dragEnd()">
        <div class="flex flex-column align-items-start justify-content-start h-full text-left w-full">
          <!-- <div>level</div> -->
          <span class="text-sm m-0 p-0">{{ task.name.length > 30 ? (task.name.slice(0, 30).trim() + '...') : task.name }}</span>
          <!-- <div class="label-area flex">
      <div class="label">label 1</div>
      <div class="label">label 2</div>
    </div> -->
        </div>

        <i class="dot-icon pi pi-trash text-primary-400 cursor-pointer" style="font-size: 1rem; position: absolute; right: 1rem; top: 50%; transform: translateY(-50%)" (click)="deleteTask($event,task.id)"></i>
      </li>

      } }
    </ul>
    }
  </div>
  }
  <div class="add-button">
    <button pButton icon="pi pi-plus" [rounded]="true" (click)="openColumnsDialog()" class="p-button-outlined p-button-primary"></button>
  </div>
  <p-confirmDialog></p-confirmDialog>
</div>

<!-- Edit Column Dialog -->
<p-dialog header="Edit Column" [(visible)]="showEditForm" [modal]="true" [style]="{width: '400px'}" [closable]="true" (onHide)="cancelEdit()">
  @if (editingColumn) {
  <div class="edit-column-form">
    <div class="form-group mb-3">
      <label for="columnTitle" class="block mb-2 font-medium">Column Title</label>
      <input pInputText id="columnTitle" [(ngModel)]="editingColumn.title" placeholder="Enter column title" class="w-full" />
    </div>

    <div class="form-group mb-3">
      <label for="columnIcon" class="block mb-2 font-medium">Icon</label>
      <p-select id="columnIcon" [options]="iconOptions" [(ngModel)]="editingColumn.icon" appendTo="body" optionLabel="label" optionValue="value" placeholder="Select an icon" class="w-full">
        <ng-template pTemplate="selectedItem" let-selectedOption>
          <div class="flex align-items-center gap-2">
            <i [class]="'pi ' + selectedOption.value" class="text-sm"></i>
            <span>{{ selectedOption.label }}</span>
          </div>
        </ng-template>

        <ng-template pTemplate="item" let-option>
          <div class="flex align-items-center gap-2">
            <i [class]="'pi ' + option.value" class="text-sm"></i>
            <span>{{ option.label }}</span>
          </div>
        </ng-template>
      </p-select>
    </div>

    <div class="form-group mb-4">
      <label for="columnColor" class="block mb-2 font-medium">Icon Color</label>
      <input type="color" id="columnColor" [(ngModel)]="editingColumn.iconColor" class="w-full" style="height: 40px; border-radius: 6px; border: 1px solid var(--surface-border)" />
    </div>
  </div>
  }

  <ng-template pTemplate="footer">
    <div class="flex justify-content-end gap-2">
      <p-button label="Cancel" icon="pi pi-times" (onClick)="cancelEdit()" [outlined]="true" severity="secondary" />
      <p-button [label]="isLoading ? 'Updating...' : 'Update Column'" icon="pi pi-check" (onClick)="updateColumn()" [disabled]="isUpdateDisabled" [loading]="isLoading" />
    </div>
  </ng-template>
</p-dialog>
